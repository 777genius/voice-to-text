# –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—É—Å–∫–∞ WebSocket E2E —Ç–µ—Å—Ç–æ–≤

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. Unit —Ç–µ—Å—Ç—ã (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API)
–≠—Ç–∏ —Ç–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É:

```bash
cd src-tauri
cargo test --test websocket_e2e_test test_e2e_connection_error_invalid_key -- --nocapture
```

–í—ã–≤–æ–¥:
```
‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –æ—à–∏–±–∫–∞: Connection("WS connection failed: HTTP error: 401 Unauthorized")
test test_e2e_connection_error_invalid_key ... ok
```

### 2. –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö e2e —Ç–µ—Å—Ç–æ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º API

–°–Ω–∞—á–∞–ª–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ API –∫–ª—é—á–∏:
```bash
export DEEPGRAM_KEY="your-key-here"
export ASSEMBLY_AI_KEY="your-key-here"
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
cargo test --test websocket_e2e_test -- --ignored --nocapture
```

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
cargo test --test websocket_e2e_test test_e2e_deepgram_websocket_connection -- --ignored --nocapture
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
‚úÖ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã—Ç–æ
test test_e2e_deepgram_websocket_connection ... ok
```

### –¢–µ—Å—Ç –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
cargo test --test websocket_e2e_test test_e2e_deepgram_reconnect -- --ignored --nocapture
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
üîå –ü–µ—Ä–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...
üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...
üîå –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è...
‚úÖ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

### –¢–µ—Å—Ç Keep-Alive –º–µ—Ö–∞–Ω–∏–∑–º–∞
```bash
cargo test --test websocket_e2e_test test_e2e_keepalive_mechanism -- --ignored --nocapture
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ...
‚è∏Ô∏è  –°—Ç–∞–≤–∏–º –Ω–∞ –ø–∞—É–∑—É (keep-alive)...
‚è±Ô∏è  –ñ–¥–µ–º 10 —Å–µ–∫—É–Ω–¥ (keep-alive —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ)...
  1 —Å–µ–∫...
  2 —Å–µ–∫...
  ...
  10 —Å–µ–∫...
‚ñ∂Ô∏è  –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∏–º...
üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–∞—É–∑—ã...
‚úÖ Keep-alive –º–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

### –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç –≤—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
```bash
cargo test --test websocket_e2e_test test_e2e_high_frequency_sending -- --ignored --nocapture
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
‚ö° –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç: –±—ã—Å—Ç—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö (10ms –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã)...
  –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 20 —á–∞–Ω–∫–æ–≤...
  –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 40 —á–∞–Ω–∫–æ–≤...
  –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 60 —á–∞–Ω–∫–æ–≤...
  –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ 80 —á–∞–Ω–∫–æ–≤...
üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
  –£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: 98
  –û—à–∏–±–æ–∫: 2
  Success rate: 98.0%
‚úÖ –í—ã—Å–æ–∫–æ—á–∞—Å—Ç–æ—Ç–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
```

### –¢–µ—Å—Ç –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
```bash
cargo test --test websocket_e2e_test test_e2e_slow_network_simulation -- --ignored --nocapture
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
üêå –ò–º–∏—Ç–∏—Ä—É–µ–º –º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–∑–∞–¥–µ—Ä–∂–∫–∏ 300-500ms)...
  –ß–∞–Ω–∫ 1 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∑–∞ 45.2ms
  –ß–∞–Ω–∫ 2 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∑–∞ 52.1ms
  –ß–∞–Ω–∫ 3 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∑–∞ 48.7ms
  ...
‚úÖ –ú–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
```

### –¢–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–∞–∑—Ä—ã–≤–∞
```bash
cargo test --test websocket_e2e_test test_e2e_recovery_after_connection_loss -- --ignored --nocapture
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
üîå –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...
üí• –ò–º–∏—Ç–∏—Ä—É–µ–º —Ä–∞–∑—Ä—ã–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (abort)...
üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ...
‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ä–∞–∑—Ä—ã–≤–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
cargo test --test websocket_e2e_test test_e2e_performance_comparison -- --ignored --nocapture
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
‚ö° –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ WebSocket –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º Deepgram...
  Deepgram: 5.23s
üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º AssemblyAI...
  AssemblyAI: 5.78s

üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:
  Deepgram:   5.23s
  AssemblyAI: 5.78s
  üèÜ Deepgram –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ 0.55s (9.5%)

‚úÖ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
```

## –ó–∞–ø—É—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º

### –í—Å–µ —Ç–µ—Å—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
cargo test --test websocket_e2e_test connection -- --ignored --nocapture
```

### –í—Å–µ —Ç–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
```bash
cargo test --test websocket_e2e_test message -- --ignored --nocapture
```

### –í—Å–µ —Ç–µ—Å—Ç—ã —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º
```bash
cargo test --test websocket_e2e_test network -- --ignored --nocapture
```

### –í—Å–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç—ã
```bash
cargo test --test websocket_e2e_test "high_frequency|batch|performance" -- --ignored --nocapture
```

## –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
```bash
RUST_LOG=debug cargo test --test websocket_e2e_test test_name -- --ignored --nocapture
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å —Ç–∞–π–º–∞—É—Ç–æ–º
```bash
timeout 60s cargo test --test websocket_e2e_test test_name -- --ignored --nocapture
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ —Ç–µ—Å—Ç—ã –∫–æ–º–ø–∏–ª–∏—Ä—É—é—Ç—Å—è
```bash
cargo test --test websocket_e2e_test --no-run
```

## Continuous Integration

–ü—Ä–∏–º–µ—Ä GitHub Actions:

```yaml
name: WebSocket E2E Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Install Rust
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable

      - name: Run unit tests (–±–µ–∑ API)
        run: |
          cd src-tauri
          cargo test --test websocket_e2e_test test_e2e_connection_error

      - name: Run E2E tests (—Å API)
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        env:
          DEEPGRAM_KEY: ${{ secrets.DEEPGRAM_KEY }}
          ASSEMBLY_AI_KEY: ${{ secrets.ASSEMBLY_AI_KEY }}
        run: |
          cd src-tauri
          cargo test --test websocket_e2e_test -- --ignored
```

## –°–æ–≤–µ—Ç—ã –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### 1. –ù–∞—á–Ω–∏—Ç–µ —Å unit —Ç–µ—Å—Ç–æ–≤
–°–Ω–∞—á–∞–ª–∞ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ unit —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –ø—Ä–æ–±–ª–µ–º.

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–ª—é—á–∏ –≤–∞–ª–∏–¥–Ω—ã –∏ –∏–º–µ—é—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫–≤–æ—Ç—ã.

### 3. –ó–∞–ø—É—Å–∫–∞–π—Ç–µ –ø–æ –æ–¥–Ω–æ–º—É —Ç–µ—Å—Ç—É
–î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –ø–æ –æ–¥–Ω–æ–º—É.

### 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ --nocapture
–í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ `--nocapture` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤.

### 5. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ –∫–∞—á–µ—Å—Ç–≤—É –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.

## Troubleshooting

### –¢–µ—Å—Ç –ø–∞–¥–∞–µ—Ç —Å timeout
- –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ –∫–æ–¥–µ —Ç–µ—Å—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ API —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã

### Authentication error
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–ª—é—á–∏ –Ω–µ –∏—Å—Ç–µ–∫–ª–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–≤–æ—Ç—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Connection refused
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ—Ç –ø—Ä–æ–∫—Å–∏
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS —Ä–µ–∑–æ–ª—é—Ü–∏—é

### Assertion failures
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ –∏–∑-–∑–∞ —Å–µ—Ç–∏
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

–í—Å–µ 16 —Ç–µ—Å—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ —É—Å–ø–µ—à–Ω–æ:
```
test result: ok. 16 passed; 0 failed; 0 ignored
```

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–µ–∑ `--ignored` –æ–¥–∏–Ω unit —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç:
```
test result: ok. 1 passed; 0 failed; 15 ignored
```
